name: 'dbt_test'

config-version: 2
version: '0.21.1'

profile: 'dbt-test'

macro-paths: ["macros"]
source-paths: ["models"]

# target-path: "target"
# clean-targets:
#     - "target"
#     - "dbt_modules"
#     - "logs"

# require-dbt-version: [">=1.0.0", "<2.0.0"]

models:
  dbt-test:
      materialized: table
      staging:
        materialized: view

on-run-end: "for row in
      select table_schema, table_name
      from information_schema.tables
      where table_type = 'BASE TABLE'
      and table_schema = 'cms_synthetic_patient_data_omop'
      and table_name ilike ('_airbyte' || '%')
   loop
      execute 'DROP TABLE ' || quote_ident(row.table_schema) || '.' || quote_ident(row.table_name) || ' CASCADE';
      raise info 'Dropped tables: %', quote_ident(row.table_schema) || '.' || quote_ident(row.table_name);
   end loop;"